DROP VIEW ig_health_adata;
CREATE VIEW ig_health_adata AS
  SELECT
    Babies.*,
    (SELECT exc_breast FROM ig_adata WHERE baby = Babies.indexcol ORDER BY created_at DESC LIMIT 1) AS exc_breast,

    (SELECT no_breast FROM ig_adata WHERE baby = Babies.indexcol ORDER BY created_at DESC LIMIT 1) AS no_breast,
    (SELECT comp_breast FROM ig_adata WHERE baby = Babies.indexcol ORDER BY created_at DESC LIMIT 1) AS comp_breast,
    (SELECT weight FROM ig_adata WHERE baby = Babies.indexcol ORDER BY created_at DESC LIMIT 1) AS aweight,
    (SELECT height FROM ig_adata WHERE baby = Babies.indexcol ORDER BY created_at DESC LIMIT 1) AS aheight,
    indexcol AS baby,
/*
    Anthropometric.height AS aheight,
    Anthropometric.no_breast AS no_breast,
    Anthropometric.comp_breast AS comp_breast,
    Anthropometric.weight AS aweight,
    Anthropometric.height AS aheight,
    Anthropometric.muac AS amuac,
*/
    () AS stunting,
    --  (RANDOM() > 0.95) AS stunting,
    (RANDOM() > 0.85) AS wasting,
    (RANDOM() > 0.75) AS underweight
  FROM
    ig_babies Babies  --  , ig_adata Anthropometric
  WHERE
        Babies.birth_date IS NOT NULL
    AND
        (SELECT
          (BabiesSub.boy IS NOT NULL OR BabiesSub.girl IS NOT NULL)
        FROM
          ig_babies BabiesSub
        WHERE
          BabiesSub.indexcol = Babies.indexcol
        )
    AND
      (SELECT
        TouAnthropou.report_date IS NOT NULL
      FROM
        ig_adata TouAnthropou
      WHERE
        TouAnthropou.baby = Babies.indexcol
      )
;
